<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nordbahn Live-Daten</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>

    <header>
        <h1>Nordbahn Live-Daten</h1>
        <h2>Aktuelle Abfahrten und Ankünfte</h2>
    </header>

    <main>
        <section>
            <h3>Bahnhof auswählen</h3>
            <input type="text" id="stationInput" placeholder="Z. B. Neumünster">
            <button id="fetchDataBtn">Daten abrufen</button>
        </section>

        <section id="results">
            <h3>Ergebnisse</h3>
            <div id="arrivalData"></div>
        </section>
    </main>

    <footer>
        <p>Nordbahn Live-Daten - Powered by Deutsche Bahn API</p>
    </footer>

    <script>
        const apiKey = '4529e0d138923d0303c90a2261e4d5c3'; // Dein API Key
        const apiUrl = "https://cors-anywhere.herokuapp.com/https://api.deutschebahn.com/free-api/v1/arrivals?station=";

        // Funktion zum Abrufen der Daten
        async function fetchTrainData(station) {
            const url = apiUrl + encodeURIComponent(station); // API-URL mit Station
            try {
                const response = await fetch(url, {
                    headers: {
                        'Authorization': `Bearer ${apiKey}`
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    displayTrainData(data);
                } else {
                    console.error('Fehler beim Abrufen der Daten', response.status);
                    alert('Fehler beim Abrufen der Daten. Bitte versuche es später erneut.');
                }
            } catch (error) {
                console.error('Fehler beim Abrufen der Daten:', error);
                alert('Fehler beim Abrufen der Daten. Bitte versuche es später erneut.');
            }
        }

        // Funktion zum Anzeigen der erhaltenen Daten
        function displayTrainData(data) {
            const arrivalDataContainer = document.getElementById('arrivalData');
            arrivalDataContainer.innerHTML = ''; // Vorherige Ergebnisse löschen

            if (data.length === 0) {
                arrivalDataContainer.innerHTML = 'Keine Abfahrten oder Ankünfte gefunden.';
                return;
            }

            // Erstelle eine Tabelle für die Ergebnisse
            const table = document.createElement('table');
            const headerRow = document.createElement('tr');
            headerRow.innerHTML = '<th>Zugnummer</th><th>Abfahrt</th><th>Ziel</th><th>Status</th>';
            table.appendChild(headerRow);

            data.forEach(train => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${train.train.number}</td>
                    <td>${new Date(train.expectedDeparture).toLocaleTimeString()}</td>
                    <td>${train.station.name}</td>
                    <td style="color: ${train.delay > 0 ? 'red' : 'green'};">${train.delay > 0 ? `Verspätung: ${train.delay} min` : 'Pünktlich'}</td>
                `;
                table.appendChild(row);
            });

            arrivalDataContainer.appendChild(table);
        }

        // Event Listener für den Button "Daten abrufen"
        document.getElementById('fetchDataBtn').addEventListener('click', () => {
            const station = document.getElementById('stationInput').value;
            if (station) {
                fetchTrainData(station);
            } else {
                alert('Bitte einen Bahnhof eingeben.');
            }
        });
    </script>

</body>
</html>
